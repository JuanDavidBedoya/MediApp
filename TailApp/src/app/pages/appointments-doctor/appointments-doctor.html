<div class="absolute top-0 left-0 h-full w-full overflow-hidden bg-blue-900 
  bg-linear-to-b from-blue-700 via-blue-400 to-blue-300">
</div>

<div class="relative flex min-h-screen items-start justify-center py-10 sm:py-20">

  <div class="mx-auto w-full max-w-6xl rounded-2xl bg-white p-6 sm:p-10 border-2 border-blue-500 relative shadow-2xl">
    <div class="mb-8 text-center">
      <h3 class="text-3xl font-bold text-blue-950">Agenda de Citas M√©dicas ü©∫</h3>
      <p class="text-blue-950 mt-2">Citas para la C√©dula de Doctor: {{ doctorCedula || 'Cargando...' }}</p>
    </div>

    <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200 flex flex-col sm:flex-row gap-4 items-center">
        
        <div class="w-full sm:w-1/2">
            <label for="filter" class="block text-sm font-medium text-blue-950 mb-1">Filtrar por Per√≠odo</label>
            <select id="filter" [ngModel]="filterType()" (change)="onFilterChange($event)"
                    class="w-full rounded-lg border bg-white px-3 py-2 text-sm text-blue-950 focus:border-blue-800 focus:outline-none transition duration-200">
                <option value="TODAY">Citas de Hoy</option>
                <option value="WEEK">Citas de la Semana</option>
                <option value="CUSTOM">D√≠a Espec√≠fico</option>
            </select>
        </div>

        @if (filterType() === 'CUSTOM') {
            <div class="w-full sm:w-1/2 transition-opacity duration-300 ease-in-out">
                <label for="customDate" class="block text-sm font-medium text-blue-950 mb-1">Seleccionar Fecha</label>
                <input type="date" id="customDate" [ngModel]="customDate()" (change)="onDateChange($event)"
                    class="w-full rounded-lg border bg-white px-3 py-2 text-sm text-blue-950 focus:border-blue-800 focus:outline-none transition duration-200">
            </div>
        }
    </div>

    @if (errorMessage()) {
        <div class="mb-6 p-4 rounded-lg text-center font-medium bg-red-100 text-red-800">
            {{ errorMessage() }}
        </div>
    }

    @if (appointmentsResource.isLoading()) {
        <div class="text-center p-8 text-blue-700 font-semibold animate-pulse">
            Cargando citas...
        </div>
    } @else {
        <div class="overflow-x-auto shadow-lg rounded-lg border border-blue-300">
            <table class="min-w-full divide-y divide-blue-200">
                <thead class="bg-blue-100">
                    <tr>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-blue-700 uppercase tracking-wider">
                            ID Cita
                        </th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-blue-700 uppercase tracking-wider">
                            Fecha / Hora
                        </th>
                        <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-blue-700 uppercase tracking-wider">
                            Paciente (C√©dula)
                        </th>
                        <th scope="col" class="hidden md:table-cell px-4 py-3 text-left text-xs font-semibold text-blue-700 uppercase tracking-wider">
                            Observaciones
                        </th>
                        <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-blue-700 uppercase tracking-wider">
                            Acciones
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    @if (appointmentsResource.value().length === 0) {
                        <tr>
                            <td colspan="5" class="px-4 py-4 text-center text-sm text-gray-500 italic">
                                No hay citas programadas para el per√≠odo seleccionado.
                            </td>
                        </tr>
                    } @else {
                        @for (appointment of appointmentsResource.value(); track appointment.idAppointment) {
                            <tr class="hover:bg-blue-50 transition duration-150">
                                <td class="px-4 py-4 whitespace-nowrap text-sm font-bold text-blue-700">
                                    {{ appointment.idAppointment }}
                                </td>
                                
                                <td class="px-4 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">{{ formatDate(appointment.date) }}</div>
                                    <div class="text-xs text-gray-500">{{ appointment.time }}</div>
                                </td>

                                <td class="px-4 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">{{ appointment.patientCedula }}</div>
                                </td>

                                <td class="hidden md:table-cell px-4 py-4 text-sm text-gray-500 truncate max-w-xs">
                                    {{ appointment.observations || 'N/A' }}
                                </td>

                                <td class="px-4 py-4 whitespace-nowrap text-center text-sm font-medium">
                                    <button (click)="goToCreateFormula(appointment)"
                                        class="text-blue-600 hover:text-blue-900 font-semibold transition duration-150 p-2 rounded-md">
                                        Generar F√≥rmula
                                    </button>
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    }
  </div>
</div>